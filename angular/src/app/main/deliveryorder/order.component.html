
<div [@routerTransition]>
    <div class="" [ngClass]="darkModeService.currentSkin === 'dark' ? 'header-navbar-shadow-dark' : 'header-navbar-shadow'"></div>
    <div class="content-wrapper container-xxl p-0">
        <div class="content-body">
    <div class=" d-flex flex-column flex-column-fluid">
     <sub-header *ngIf="theme != 'theme12'" [title]="'Orders' | localize" [description]="'OrdersHeaderInfo' | localize">
               <div role="actions">
                   <button (click)="exportToExcel()" class="btn btn-outline-success"><i class="fa fa-file-excel"></i> {{l("ExportToExcel")}}</button>
                  
                   <!-- <button  (click)="deleteAllForEver()"  *ngIf="isAdmin"
                                          class="btn btn-primary blue"><i class="fa fa-trash p-0 font-12"></i> {{l("Delete All Orders")}}</button> -->
               </div>
              </sub-header>
              <sub-header *ngIf="theme === 'theme12'" [title]="'Orders' | localize" [description]="'OrdersHeaderInfo' | localize"> </sub-header>

      
      <div  [ngClass]="theme != 'theme12' ? 'container' : ''">
          <div class=" card-custom gutter-b"  [ngClass]="darkModeService.currentSkin === 'dark' ? 'dark-card' : 'card'">
              <div class="card-body">
                <form *ngIf="theme != 'theme12'" class="form" autocomplete="off">
                    <div>
                        <div class="row align-items-center">
                            <div class="col-xl-12">
                                <div class="form-group m-form__group align-items-center">
                                    <div class="input-group">
       
                                      
                                    </div>
                                </div>
                            </div>
                        </div>
						 <div class="row" [hidden]="!advancedFiltersAreShown">
						 	<div class="col-md-12">
						         <div class="kt-separator kt-separator--border-dashed"></div>
						     </div>

                             <div class="row" style="width: 816px;">
                                <div >
                                    <div class="row">
                                        <label for="IsOpenFilterSelect">Status</label>
                                    </div>
                                <div class="row" style="width: 816px;">


                                   <div class="col-3">
                                            
                                       <select class="form-control" name="nameFilter" id="nameFilter" [(ngModel)]="nameFilter">
                                        <option value="-1">{{l("All")}}</option>
                                        <option value="1">Pending</option>
                                        <option value="2">Done</option>
                                        <option value="3">Delete</option>
                                        <option value="6">Canceled</option>
                                        <option value="7">Pre Order</option>
        
                                        </select>
                                    </div>
                                    <div class="col-2">

                                        <span class="input-group-btn">
                                            <button (click)="getOrders($event)" class="btn btn-primary" type="submit"><i class="flaticon-search-1"></i></button>
                                        </span>
                                    </div>

                                </div>
                                   
                                    
                                   
                                </div>
                               
                             </div>


                        

				

                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-12">
                                <span class="clickable-item text-muted" *ngIf="!advancedFiltersAreShown" (click)="advancedFiltersAreShown=!advancedFiltersAreShown"><i class="fa fa-angle-down"></i> {{l("ShowAdvancedFilters")}}</span>
                                <span class="clickable-item text-muted" *ngIf="advancedFiltersAreShown" (click)="advancedFiltersAreShown=!advancedFiltersAreShown"><i class="fa fa-angle-up"></i> {{l("HideAdvancedFilters")}}</span>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="row mb-2" *ngIf="theme === 'theme12'">
                    <div class="col-md-6 col-12">
                        <div class="d-flex ml-1 align-items-center pr-1 pb-1 pl-1 pl-md-0 pb-md-0">
                            <select class="form-control" name="nameFilter" id="nameFilter" [(ngModel)]="nameFilter">
                                <option value="-1">{{l("All")}}</option>
                                <option value="1">Pending</option>
                                <option value="2">Done</option>
                                <option value="3">Delete</option>
                                <option value="6">Canceled</option>
                                <option value="7">Pre Order</option>

                                </select>
                            <button (click)="getOrders($event)" class="btn btn-primary-info" type="submit"><i class="flaticon-search-1"></i></button>
                        </div>
                    </div>
                    <div class="col-md-6 col-12 text-right">
                        <button (click)="exportToExcel()" class="btn btn-outline-primary-info mr-1" >
                            <i class="fa fa-file-excel"></i> {{ l("ExportToExcel") }}
                        </button>
                    </div>
                </div>
  
                  <div class=" align-items-center">
                      <!--<Primeng-Datatable-Start>-->
                      <div 
                      [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : 'light'"class="primeng-datatable-container col-12"
                           [busyIf]="primengTableHelper.isLoading">
                          <p-table #dataTable
                          [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : 'light'"
                                       (onLazyLoad)="getOrders($event)"
                                       class="table-responsive"
                                       [value]="primengTableHelper.records"
                                       rows="{{primengTableHelper.defaultRecordsCountPerPage}}"
                                       [paginator]="false"
                                       [lazy]="true"
                                       [scrollable]="true"
                                       ScrollWidth="100%"
                                       [responsive]="primengTableHelper.isResponsive"
                                       [resizableColumns]="primengTableHelper.resizableColumns">

                                       
                              <ng-template pTemplate="header" [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : 'light'">
                                  <tr>
                                      <th style="width:40px" >{{l('Actions')}}</th>

                                      <th style="width:50px"   pSortableColumn="AgentId" >
                                        {{l('Agent')}}
                                        <!-- <p-sortIcon field="order.AgentId"></p-sortIcon> -->
                                       </th>
   
                                      <th style="width:50px"  pSortableColumn="orderNumber" > 
                                          {{l('Order #')}}
                                          <!-- <p-sortIcon field="order.orderNumber"></p-sortIcon> -->
                                      </th>

                                      <th style="width:100px" pSortableColumn="contactId" >
                                        {{l('Customer')}}
                                        <!-- <p-sortIcon field="order.contactId"></p-sortIcon> -->
                                    </th>

                                      <th style="width:100px"  pSortableColumn="creationTime">
                                          {{l('Date')}}
                                          <!-- <p-sortIcon field="order.creatTime"></p-sortIcon> -->
                                      </th>

                                      <th style="width:100px"  pSortableColumn="creationTime" >
                                        {{l('Time')}}
                                        <!-- <p-sortIcon field="order.creationTime"></p-sortIcon> -->
                                    </th>

                                      <!-- <th style="width: 150px" pSortableColumn="areahName">
                                        {{l('BranchName')}}
                                        <p-sortIcon field="areahName"></p-sortIcon>
                                    </th> -->
                                    <!-- <th style="width: 150px" pSortableColumn="areaName">
                                        {{l('AreaName')}}
                                        <p-sortIcon field="areaName"></p-sortIcon>
                                    </th> -->
                                    
                                    <th style="width:100px" pSortableColumn="orderStatus" >
                                        {{l('Status')}}
                                        <!-- <p-sortIcon field="order.orderStatus"></p-sortIcon> -->
                                    </th>

                                   
<!-- 
                                    <th pSortableColumn="OrderType"  >
                                        {{l('Type')}}
                                      
                                    </th> -->
<!-- 
                                    <th pSortableColumn="AreaId"  >
                                        {{l('Restaurant Name')}}
                                       
                                    </th> -->
                                    <!-- <th pSortableColumn="BranchAreaName"  >
                                        {{l('Branch Name')}}
                                    </th> -->
                                    
                                    <!-- <th style="width: 150px" pSortableColumn="address">
                                        {{l('Address')}}
                                        <p-sortIcon field="address"></p-sortIcon>
                                    </th> -->


                                    <th style="width:40px"  pSortableColumn="Total" >
                                        {{l('Total')}}
                                        <!-- <p-sortIcon field="order.total"></p-sortIcon> -->
                                    </th>

  
                                  </tr>
                              </ng-template>                           
                              <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                               

                                  <tr  >
                                    <td style="width:40px" >
                                       <div class="btn-group dropdown" dropdown container="body" *ngIf="!record.order.isLockByAgent || record.order.agentId==appSession.user.id || isAdmin">
                                            <button [ngClass]="theme != 'theme12' ? 'btn-primary' : 'btn-primary-info'" class="dropdown-toggle btn btn-sm " style="cursor: pointer;"   dropdownToggle>
                                                <i class="fa fa-cog"></i><span class="caret"></span> 
                                            </button >
                                                <ul class="dropdown-menu"  *dropdownMenu>

                                                  <li >
                                                      <a href="javascript:;" class="dropdown-item" *ngIf="!record.order.isLockByAgent"
                                                          (click)="lockOrder(record.order,record.order.stringTotal)">{{l('Lock')}}</a>
                                                  </li>
                                                  <li>
                                                    <a href="javascript:;" class="dropdown-item " *ngIf="record.order.isLockByAgent"
                                                          (click)="UnlockOrderS(record.order,record.order.stringTotal)">{{l('UnLock')}}</a>
                                                </li>
                                                  
                                                <li>
                                                    <a href="javascript:;" class="dropdown-item"
                                                        (click)="viewDeliveryOrderModal.show(record)">{{l('View')}}</a>
                                                </li>

                                                <li>
                                                    <a href="javascript:;" class="dropdown-item" *ngIf="isAdmin"
                                                        (click)="deleteForEver(record.order)">{{l('Delete')}}</a>
                                                </li>
                                               
                                                <!-- <li>
                                                <a href="javascript:;"  class="dropdown-item"
                                                        (click)="createOrEditOrderModal.show(record.order.id)">{{l('Edit')}}</a>												
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="javascript:;"
                                                        (click)="deleteOrder(record.order)">{{l('Delete')}}</a>
                                                </li> -->
                                            </ul>
                                        </div>
                                    </td>


                                  <td style="width:50px" (click)="viewDeliveryOrderModal.show(record)">
                                    <span class="p-column-title"> {{l('Agent')}}</span>
                                    {{record.order.lockByAgentName}}
                                </td>


                                       <td style="width:50px" (click)="viewDeliveryOrderModal.show(record)">
                                            <span class="p-column-title"> {{l('Order #')}}</span>
                                            {{record.order.orderNumber}}
                                        </td>



                                        <td style="width:100px"   (click)="viewDeliveryOrderModal.show(record)">
                                            <span class="p-column-title"> {{l('Customer')}}</span>
                                            {{record.customerCustomerName}}
                                        </td>


                                        <td style="width:100px" (click)="viewDeliveryOrderModal.show(record)">
                                          <span class="p-column-title"> {{l('Date')}}</span>
                                          {{record.creatDate}}
                                      </td>
                                      
                                      

                                    <td style="width:100px"  (click)="viewDeliveryOrderModal.show(record)">
                                      <span class="p-column-title"> {{l('Time')}}</span>
                                      {{record.creatTime}}
                                  </td>



                                      <td style="width:100px"   (click)="viewDeliveryOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Status')}}</span>

                                        <button *ngIf="record.orderStatusName=='Done'" class="btn btn-success" style="pointer-events: none;font-size: medium; color: #ffffff; background-color: #00ba36; border-color: #1BC5BD;width: 100px;">{{record.orderStatusName}}</button>
                                        <button *ngIf="record.orderStatusName=='Deleted'" class="btn btn-secondary" style="pointer-events: none;font-size: medium;width: 100px; ">{{record.orderStatusName}}</button>
                                        <button *ngIf="record.orderStatusName=='Pending'" class="btn btn-danger" style="pointer-events: none;font-size: medium;width: 100px; ">{{record.orderStatusName}}</button>
                                        <button *ngIf="record.orderStatusName=='Canceled'" class="btn btn-warning" style="pointer-events: none;font-size: medium; width: 100px;">{{record.orderStatusName}}</button>
                                        <button *ngIf="record.orderStatusName=='Pre_Order'" class="btn btn-primary" style="pointer-events: none;font-size: medium; color: #ffffff; background-color: #007bff; border-color: #007bff; width: 100px;">{{record.orderStatusName}}</button>
                                    </td>

                                   

                                    <!-- <td style="background-color: #ffffff; font-family: system-ui;cursor: pointer" *ngIf="!(record.orderTypeName=='Takeaway')" (click)="viewOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Type')}}</span>
                                        {{record.orderTypeName}}
                                    </td> -->
                                    <!-- <td style="background-color: #ffffff; font-family: system-ui;cursor: pointer" *ngIf="!(record.orderTypeName=='Takeaway')" (click)="viewOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Restaurant Name')}}</span>
                                        {{record.areahNametow}}
                                    </td>
                                    <td style="background-color: #ffffff; font-family: system-ui;cursor: pointer" *ngIf="!(record.orderTypeName=='Takeaway')" (click)="viewOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Branch Name')}}</span>
                                        {{record.areaCoordinatetow}}
                                    </td> -->



<!--
                                    <td style="width:40px" (click)="viewDeliveryOrderModal.show(record)">
                                      <span class="p-column-title"> {{l('Type')}}</span>
                                      {{record.orderTypeName}} 
                                    </td>-->
                                    <!-- <td style="background-color: #ffffff; font-family: system-ui;cursor: pointer" *ngIf="record.orderTypeName=='Takeaway'" (click)="viewOrderModal.show(record)">
                                      <span class="p-column-title"> {{l('Restaurant Name')}}</span>
                                       {{record.areaCoordinatetowTak}}  
                                    </td>
                                    <td style="background-color: #ffffff; font-family: system-ui;cursor: pointer" *ngIf="record.orderTypeName=='Takeaway'" (click)="viewOrderModal.show(record)">
                                      <span class="p-column-title"> {{l('Branch Name')}}</span>
                                       {{record.areahNametowTak}}  
                                    </td> -->





                                    <!-- <td *ngIf="record.order.orderRemarks=='CancelByCustomer' && record.orderTypeName=='Takeaway'  && !(record.orderStatusName=='Done')"  style="background-color: red;  font-family: system-ui;cursor: pointer"(click)="viewOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Type')}}</span>
                                        {{record.orderTypeName}} / {{record.areahName}}  
                                    </td>
                                    <td style=" background-color: #ffffff;font-family: system-ui;cursor: pointer" *ngIf="!(record.order.orderRemarks=='CancelByCustomer') && record.orderTypeName=='Takeaway' && !(record.orderStatusName=='Done')" (click)="viewOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Type')}}</span>
                                        {{record.orderTypeName}} / {{record.areahName}}  
                                    </td>
                                    <td style="background-color: #eae4e4; font-family: system-ui;cursor: pointer" *ngIf="!(record.order.orderRemarks=='CancelByCustomer') && record.orderTypeName=='Takeaway' && (record.orderStatusName=='Done')" (click)="viewOrderModal.show(record)">
                                        <span class="p-column-title"> {{l('Type')}}</span>
                                        {{record.orderTypeName}} / {{record.areahName}}  
                                    </td> -->
             
                           
                                      
                                      <td style="width:40px"  (click)="viewDeliveryOrderModal.show(record)">
                                          <span class="p-column-title"> {{l('Total')}}</span>
                                          {{record.order.stringTotal}} JD
                                      </td>


                                </tr>


                                 
                              </ng-template>
                          </p-table>
                          <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                              {{l('NoData')}}
                          </div>
                          <div class="primeng-paging-container">
                              <p-paginator [rows]="primengTableHelper.defaultRecordsCountPerPage"
                                           #paginator
                                           (onPageChange)="getOrders($event)"
                                           [totalRecords]="primengTableHelper.totalRecordsCount"
                                           [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">
                              </p-paginator>
                              <span class="total-records-count">
                                  {{l('TotalRecordsCount', primengTableHelper.totalRecordsCount)}}
                              </span>
                          </div>
                      </div>
                      <!--<Primeng-Datatable-End>-->
                  </div>
              </div>
          </div>
      </div>
      <!-- <createOrEditOrderModal #createOrEditOrderModal (modalSave)="getOrders()"></createOrEditOrderModal>     -->
      <viewDeliveryOrderModal #viewDeliveryOrderModal></viewDeliveryOrderModal>
      
    </div>
    </div>
    </div>
  </div>
  
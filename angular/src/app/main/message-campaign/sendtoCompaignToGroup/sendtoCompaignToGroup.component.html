<div class="row  m-1 ">
  <h4 class="text-danger">{{l("totlaMessageAllowed") }} : {{countallowedperday}}</h4>
  <h4 class="text-danger">{{l("remainingMessageAllowed") }} : {{dailyLimit}}</h4>


  <div class="row ">


    <div class="row mb-2">
      <div class="col-6">
        <ng-select [items]="groups" bindLabel="groupName" [trackByFn]="trackByFn" (scrollToEnd)="onScroll()"
          [loading]="customerApiLoading" typeToSearchText="Please start typying " [typeahead]="customerApiInput$"
          placeholder="Select Group" [(ngModel)]="selectedContact" (change)="handleSelectChange($event)">
          <ng-template ng-option-tmp let-item="item">
            <div class="d-flex">
        
              <b class="mr-1">
                {{item.groupName}}
              </b>
              <span class="mr-1" [ngStyle]="{'color': item.totalNumber ===0 ? 'red' : 'green' }">
                ({{item.totalNumber}})
              </span>
            </div>
          </ng-template>
        </ng-select>
      </div>

      <div *ngIf="customers.length>0" class="col-6">
        <div *ngIf="templateById" class="row justify-content-center ">
          <div class="col-12 col-md-7  templateCard p-3" [ngClass]="VariableCount===0 ? 'col-md-8' : 'col-md-7'">
            <div class="card-template p-1">
              <div class="row mb-1" *ngIf="ComponentHeader?.text">
                <h4 [ngClass]="templateById.language === 'ar' ? 'rtl':'ltr'">
                  {{ ComponentHeader?.text }}
                </h4>
              </div>
              <div class="row mb-1" *ngIf="imageFlag">
                <img class="p-0" src="{{ templateById.mediaLink }}" alt="Campaign Image" />
              </div>
              <div class="row mb-1 " *ngIf="videoFlag ">
                <iframe class="p-0" [src]="templateById.mediaLink | custom" frameborder="0"></iframe>
              </div>
              <div class="row  mb-1" *ngIf="documentFlag ">
                <iframe class="p-0" [src]="templateById.mediaLink | custom" frameborder="0"></iframe>
              </div>
              <div class="row" id="displayText">
                <p [ngClass]="templateById.language === 'ar' ? 'rtl':'ltr'">
                  {{ displayText }}
                </p>
              </div>
            </div>
            <div class="card-footer footerCard p-1 pt-0" *ngIf="ComponentFooter?.text">
              <small [ngClass]="templateById.language === 'ar' ? 'rtl':'ltr'">
                {{ ComponentFooter?.text }}
              </small>
            </div>
            <div class="row  buttonText" *ngIf="ComponentButton.buttons">
              <div class="col p-0" *ngFor="let button of ComponentButton.buttons">
                <button class="btn btn-light">
                  {{ button.text }}
                </button>
              </div>

            </div>

          </div>

          <div *ngIf="VariableCount > 0" class="col-12 col-md-4 mx-1">
            <ng-container *ngFor="let part of dynamicTextParts; let i = index">
              <ng-container *ngIf="part.type === 'input';">
                <label for="template-teamInbox">Custome Field {{ '{{' + ((part.index) + 1) + '}}' }} *</label>

                <input class="form-control" id="template-teamInbox" name="template-teamInbox"
                  [(ngModel)]="inputs[part.index].value" (ngModelChange)="updateText()" [placeholder]="part.content"
                  (keypress)="onKeyPress($event)" />
                <p class="text-danger" *ngIf="updatebtn && inputs[part.index].value.length === 0">{{
                  l("ThisFieldIsRequired") }}</p>
              </ng-container>
            </ng-container>
            <button id="updatevar" type="button" class="btn btn-primary-info my-2 mr-1"
              [buttonBusy]="updateVariablesFlag" (click)="updateVariables()" [disabled]="false">
              {{l("updateVariables") }}
            </button>
          </div>

        </div>
      </div>

    </div>


    <div class="divider divider-default">
      <div class="divider-text">{{l("sendCampaign") }}</div>
    </div>

    <div class="col-12">

      <button id="btnSend" type="button"  [disabled]="  (totalRecords==0 ) || (isSchedule)|| (selectedCustomers?.length === 0 ) || (selectedCustomers?.length > dailyLimit) || ((VariableCount>0 &&  !isVariablesValidFlag) ||(VariableCount==0 &&  isVariablesValidFlag) )"  class="btn btn-primary-info"
        (click)="sendCampaign(true)" [buttonBusy]="saving && !isSchedule">
        {{l("sendNow") }}
      </button>
      <div class=" m-checkbox-list form-check form-switch my-1">
        <input class="form-check-input" id="Schedule" type="checkbox" name="Schedule" [checked]="isSchedule"
          (input)="handleIsSchedule($event)" />
        <label for="Schedule" class="kt-checkbox">Schedule Message</label>
      </div>


      <div *ngIf="isSchedule===true">

        <p-calendar [(ngModel)]="dateAndTime" [iconDisplay]="'input'" [showTime]="true" [minDate]="minDate"
          [showIcon]="true" class="btn-primary-info my-1"></p-calendar>

        <div class="my-1">
          <button id="btnSend" type="button"   
              [disabled]=" (totalRecords==0 ) || ( !isSchedule) || (selectedCustomers?.length === 0)  || (selectedCustomers?.length > dailyLimit )|| ((VariableCount>0 &&  !isVariablesValidFlag) ||(VariableCount==0 &&  isVariablesValidFlag) )" class="btn btn-primary-info"
            (click)="sendCampaign(false)" [buttonBusy]="saving && isSchedule">
            {{l("messageSchedualing") }}
          </button>
        </div>

      </div>

    </div>


    <div class="row" *ngIf="customers.length>0">

      <p-table class="w-100" [value]="customers" dataKey="phoneNumber" [selection]="selectedCustomers"
        (selectionChange)="onSelectionChange($event)" [paginator]="true" [rows]="10" [totalRecords]="totalRecords"
        [loading]="loadingTable" [rowsPerPageOptions]="[10, 20, 30]" responsiveLayout="stack" [responsive]="true"
        currentPageReportTemplate="{totalRecords}" [selectionPageOnly]="true" editMode="row">
        <ng-template pTemplate="caption">
          <ng-container *ngIf="selectedCustomers">

            {{l("numberOfSelectedMembers") }} <span
              [ngStyle]="{'color': selectedCustomers?.length > dailyLimit  ? 'red' : 'green' }">{{selectedCustomers?.length}}</span>

          </ng-container>

        </ng-template>
        <ng-template pTemplate="header">

          <tr>
            <th>
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              <!-- <span class="p-column-title mx-1">{{ l("deleteFromGroup") }}</span> -->
            </th>
            <th> {{l("groupContactName") }}</th>
            <th> {{ l("PhoneNumber") }}</th>
            <ng-container *ngIf="isVariablesValidFlag">
              <ng-container *ngFor="let item of listofvar">
                <th *ngIf="item === 'varOne'"> {{l("varOne") }}</th>
                <th *ngIf="item === 'varTwo'"> {{l("varTwo") }}</th>
                <th *ngIf="item === 'varThree'"> {{l("varThree") }}</th>
                <th *ngIf="item === 'varFour'"> {{l("varFour") }}</th>
                <th *ngIf="item === 'varFive'"> {{l("varFive") }}</th>
              </ng-container>
              <th style="width:8rem"></th>
            </ng-container>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-customer let-editing="editing" let-ri="rowIndex">
          <tr [pEditableRow]="customer">
            <td>
              <p-tableCheckbox [value]="customer"></p-tableCheckbox>
              <!-- <span class="p-column-title"> {{ l("Select") }}</span> -->
            </td>



            <td>
              <span class="p-column-title">
                {{l("groupContactName") }}
              </span>
              {{customer.contactName}}
            </td>
            <td>
              <span class="p-column-title">
                {{ l("PhoneNumber") }}
              </span>
              {{customer.phoneNumber}}
            </td>

            <!-- EDiting Column  -->

            <ng-container *ngIf="isVariablesValidFlag">
              <td *ngFor="let item of listofvar" pEditableColumn>
                <p-cellEditor>

                  <ng-template pTemplate="input">
                    <input pInputText type="text" class="form-control" [(ngModel)]="customer.templateVariables[item]"
                      required />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ customer.templateVariables[item] }}
                  </ng-template>
                </p-cellEditor>
              </td>

              <td style="text-align:center">
                <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                  style="color: #009789;" (click)="onRowEditInit(customer)"
                  class="p-button-rounded p-button-text"></button>
                <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check"
                  (click)="onRowEditSave(customer)"
                  class="p-button-rounded p-button-text p-button-success p-mr-2"></button>
                <!-- <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times"
                              (click)="onRowEditCancel(customer, ri)" class="p-button-rounded p-button-text p-button-danger"></button> -->
              </td>

            </ng-container>




          </tr>
        </ng-template>
      </p-table>

      <div class="primeng-no-data" *ngIf="customers.length== 0">
        {{ l("NoData") }}
      </div>

      <div *ngIf="customers.length !== 0" class="primeng-paging-container">
        <span class="total-records-count">
          {{ l("TotalRecordsCount", customers.length) }}
        </span>
      </div>
    </div>
  </div>
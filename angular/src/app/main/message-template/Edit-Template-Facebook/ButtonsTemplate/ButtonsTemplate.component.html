<div class="form-group ">
  <h3>Buttons <span class="Optional">• Optional</span></h3>
  <p *ngIf="!checkCompleteFlow">Create buttons that let customers respond to your message or take action. You can add up to 10 buttons. If you add more than 3 buttons, they will appear in a list.</p>
  <p *ngIf="checkCompleteFlow">Edit label for the button that lets customers take an action.</p>

  <div *ngIf="checkCompleteFlow" class="CompleteFlowNote">
    <span class="icon-lamp">💡</span>
    <span class="note-text">
     <p> Only one button is supported for this type of template.  </p>
    </span>
  </div>
  <div class="container-addButton ">
    <div class="dropdown">
      <button class=" dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
        + Add Button
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <h3>Quick reply buttons</h3>
         <button class="dropdown-item" *ngIf="template.category!='UTILITY'"  (click)="onButtonTypeChange('Marketing-opt-out')" [disabled]="isMarketinOptOutDisabled">
          Marketing opt-out <span class="recommended">Recommended</span>
        </button> 
        <button  class="dropdown-item" (click)="onButtonTypeChange('custom')"  [disabled]="isCustomDisabled" >Custom</button>
        <div class="dropdown-divider"></div>
        <h3>Call to action buttons</h3>
        <button class="dropdown-item" (click)="onButtonTypeChange('visit-website')" [disabled]="isVisitWebsiteDisabled">
          Visit website <span class="button-limit">2 buttons maximum</span>
        </button>
        <button class="dropdown-item" (click)="onButtonTypeChange('call-phone-number')" [disabled]="isCallButtonDisabled">
          Call phone number <span class="button-limit">1 button maximum</span>
        </button>
        <!-- <button class="dropdown-item"  (click)="onButtonTypeChange('complete-flow')" [disabled]="isCompleteFlowDisabled||hasButtons" >
          Complete Flow <span class="button-limit">1 button maximum</span>
        </button> -->
        <button class="dropdown-item" (click)="onButtonTypeChange('copy-offer-code')"   [disabled]="isCopyOfferCodeDisabled"   >
          Copy offer code <span class="button-limit">1 button maximum</span>
        </button>
        </ul>
    </div>
  </div>

  <div *ngIf="!checkCompleteFlow && selectedCategory!='UTILITY'"  class="CompleteFlowNote box-shadow">
    <span  class="icon-lamp">💡</span>
    <span class="note-text">
      <h3>We recommend adding the marketing opt-out button</h3>
      <p>Allow customers to request to opt out of all marketing messages. This can help reduce blocks from customers and increase your quality rating. Learn more.</p>
    </span>
  </div>
  <div class="buttons-section" >
    <div *ngIf="CallToAction">
      <p>Call to Action <span class="Optional">• Optional</span></p>
    </div>
    <div *ngFor="let button of Buttons.buttons; let i = index">
      <div class="button-row" *ngIf="button.type === 'URL' || button.type === 'PHONE_NUMBER' || button.type === 'COPY_CODE' || button.type === 2">       
       <div class="field padding-left" >
         <label>Type of Action</label>
         <select [(ngModel)]="button.type" (change)="onActionChange(button)">
          <option value="URL" [disabled]="isVisitWebsiteDisabled">Visit website</option>
          <option value="PHONE_NUMBER" [disabled]="isCallButtonDisabled">Call phone number</option>
          <option value="COPY_CODE" [disabled]="isCopyOfferCodeDisabled">Copy offer code</option>
          <!-- <option [value]="button.type">complete-flow</option> -->
        </select>
       </div>
 
         <div class="field">
          <label>Button Text</label>
          <div class="button-text-container" style="position: relative;">
            <input 
              type="text"
              [disabled]="button.type=='COPY_CODE'"
              (input)="validateButtons()" 
              placeholder="Button Text" 
              [(ngModel)]="button.text"
              required
              maxlength="25" 
              class="button-text-input"
            >
            <!-- Character counter -->
            <span class="button-text-counter" 
                  [ngClass]="{
                    'text-danger': (button.text?.length || 0) >= 25,
                    'text-warning': (button.text?.length || 0) >= 23 && (button.text?.length || 0) < 25
                  }">
              {{button.text?.length || 0}}<span *ngIf="maxLength">/{{maxLength}}</span>
            </span>
          </div>
          <span *ngIf="duplicateError[i]" class="error-message">
            You can't enter the same text for multiple buttons
          </span>
        </div>
       <div class="field" *ngIf="button.type === 'URL'">
        <label>URL Type</label>
        <select  (change)="OnURLTypeChange(button,i)">
          <option value="Static" [selected]="!button.example">Static</option>
          <option value="Dynamic" [selected]="button.example">Dynamic</option>
        </select>
      </div>
      <div class="field" *ngIf="button.type == 'URL'">
            <label>Website URL</label>
            <div class="url-container" style="position: relative;">
              <input 
                style="width: 50%;"  
                class="error-border url-input" 
                type="url"
                placeholder="https://www.example.com"
                [(ngModel)]="button.url"
                [ngModelOptions]="{standalone: true}" 
                [pattern]="urlPattern"
                (input)="onURLChange($event, i)"
                required
                maxlength="2048" 
              />
              <!-- Character counter -->
              <span class="url-character-counter"
                    [ngClass]="{
                      'text-danger': (button.url?.length || 0) >= 2000,
                      'text-warning': (button.url?.length || 0) >= 1800 && (button.url?.length || 0) < 2000
                    }">
                {{button.url?.length || 0}}/2048
              </span>
              <span *ngIf="button.example && button.type == 'URL'">{{'{{1}}'}}</span>
            </div>  
            <label *ngIf="isUrlInvalid(i)" class="error-message">Please enter a valid URL</label> 
          </div>
       <!-- <div class="field" *ngIf="button.type == 'URL'">
         <label>Website URL</label>
         <div class="url-container">
           <input style="width: 50%;"  class="error-border" type="url"
                  placeholder="https://www.example.com"
                  [(ngModel)]="button.url"
                  [ngModelOptions]="{standalone: true}" 
                  [pattern]="urlPattern"
                  (input)="onURLChange($event, i)"
                  required
                  />
           <span *ngIf="button.example && button.type == 'URL'">{{'{{1}}'}}</span>
         </div>  
         <label *ngIf="isUrlInvalid(i)"  class="error-message">Please enter a valid URL</label> 
       </div> -->


        <div class="field" *ngIf="button.type == 'COPY_CODE'">
          <label>Offer code</label>
          <div class="offer-code-container" style="position: relative;">
            <input 
              type="text" 
              placeholder="Enter sample" 
              [(ngModel)]="button.example[0]" 
              (ngModelChange)="initializeExample(button)"
              maxlength="15"
              class="offer-code-input"
            >
            <span class="offer-code-counter"
                  [ngClass]="{
                    'text-danger': (button.example[0]?.length || 0) >= 15,
                    'text-warning': (button.example[0]?.length || 0) >= 13 && (button.example[0]?.length || 0) < 15
                  }">
              {{button.example[0]?.length || 0}}/15
            </span>
          </div>
          <label *ngIf="button.example[0].length == 0" class="error-message">Add sample text</label>
        </div>
       <!-- <div class="field" *ngIf="button.type == 'COPY_CODE'">
         <label>Offer code</label>
         <input type="text" placeholder="Enter sample" 
         [(ngModel)]="button.example[0]" 
         (ngModelChange)="initializeExample(button)"
          maxlength="50" 
         > 
         <label *ngIf="button.example[0].length == 0" style="color: red;">Add sample text</label> 
       </div> -->

       <div class="field" *ngIf="button.type == 'PHONE_NUMBER'">
        <label>Country</label>
        <ngx-intl-tel-input
        #telInput
        style="width: 150%;"
        class="d-contents"
        id="countryCode"
        [enablePlaceholder]="true"
        [searchCountryFlag]="true"
        [maxLength]="13"
        [selectFirstCountry]="false"
        [enableAutoCountrySelect]="true"
        [phoneValidation]="true"
        [separateDialCode]="false"
        [numberFormat]="'International'"
        [preferredCountries]="preferredCountries"
        [(ngModel)]="phonenumber"
        [cssClass]="'form-control'"
        required
        (ngModelChange)="onPhoneNumberChange()"
        [class.error]="!phonenumber || !phoneForm.value"
      >
        <p class="text-danger" *ngIf="!phoneForm.value">{{ ("ThisFieldIsRequired") }}</p>
        <p class="text-danger" *ngIf="phonenumber && phoneForm.status !== 'VALID'">Please Enter Valid Phone Number</p>
      </ngx-intl-tel-input>
      </div>
       <button type="button" class="remove-btn" (click)="removeButton(i)">
         <i class="fas fa-times"></i>
       </button>
     </div>
     
     <div *ngIf="button.example && button.type == 'URL'" class="sample-inputs Content-Parts padding-left" style="padding-left: 20px;" >
       <h3>Add sample URL</h3>
       <p>To help us review your message template, please add an example of the website URL Do not use real customer information.</p>
       <div class="sample-variable">
         <label  style="display: inline;">{{'{{1}}'}}</label>
         <input 
           type="text" 
           [ngModelOptions]="{standalone: true}" 
           [pattern]="urlPattern"
           [(ngModel)]="button.example[0]"
           (input)="onURLExampleChange($event, i)"
           placeholder="Enter Example dynamic URL  {{'{{1}}'}}"
           required
         />
       </div>
       <div  *ngIf="isUrlInvalidExample(i)">
         <p class="error-message">this is required</p>
       </div>
       
     </div>
   </div>

    <div class="marketing-opt-out" *ngIf="checkboxWebSite">
      <div class="checkbox-label-wrapper">
        <input type="checkbox" [(ngModel)]="visitWebsiteCheckboxStates">
        <p>You direct Meta to use link tracking to report website clicks. When this box is unchecked, you will not see insights for website clicks.</p>
      </div>
    </div>

    <div *ngIf="hasQuickReply">
      <p>Quick Reply<span class="Optional">• Optional</span></p>
    </div>
    <div *ngFor="let button of Buttons.buttons ; let i = index" style="display: block;" >
      <div  class="button-row" *ngIf="button.type === 'QUICK_REPLY'">
        <div class="field padding-left"  *ngIf="button.type === 'QUICK_REPLY'|| button.type === 'QUICK_REPLY'">
          <label>Type of Action</label>
          <select  (change)="onActionChangeInQuickReply(button)">
            <option value="Quick Reply" [disabled]="isCustomDisabled">custom</option>
            <option value="Marketing-opt-out" [disabled]="isMarketinOptOutDisabled">Marketing-opt-out</option>
          </select>
        </div>
        <div class="field" *ngIf="button.text !== 'Stop promotions' && button.text !== 'إيقاف عمليات الترويج'">
          <label>Button Text</label>
          <div class="button-text-container" style="position: relative;">
            <input 
              type="text" 
              required 
              placeholder="Button Text" 
              [(ngModel)]="button.text" 
              [maxLength]="25"
              (input)="validateButtons()"
              class="button-text-input"
            >
            <span class="button-text-counter"
                  [ngClass]="{
                    'text-danger': (button.text?.length || 0) >= 25,
                    'text-warning': (button.text?.length || 0) >= 20 && (button.text?.length || 0) < 25
                  }">
              {{button.text?.length || 0}}/25
            </span>
          </div>
          <span *ngIf="duplicateError[i]" class="error-message">
            You can't enter the same text for multiple buttons
          </span>
        </div>
        <!-- <div class="field" *ngIf="button.text !== 'Stop promotions' && button.text !== 'إيقاف عمليات الترويج'">
          <label>Button Text</label>
          <input 
            type="text" 
            required 
            placeholder="Button Text" 
            [(ngModel)]="button.text" 
            [maxLength]="15"
            (input)="validateButtons()">
          <span *ngIf="duplicateError[i]" class="error-message">
            You can't enter the same text for multiple buttons
          </span>
        </div> -->
        
        <div class="field" *ngIf="button.text === 'Stop promotions' ||button.text === 'إيقاف عمليات الترويج'">
          <label>Button Text</label>
          <input type="text" *ngIf="template.language== 'en'" required  [disabled]="button.text === 'Stop promotions'"  placeholder="Button Text" [(ngModel)]="button.text">
          <input type="text" *ngIf="template.language== 'ar'" required  [disabled]="button.text === 'إيقاف عمليات الترويج'"  placeholder="Button Text" [(ngModel)]="button.text">
        </div>  

       <div class="field" *ngIf="button.text === 'Stop promotions' ||button.text === 'إيقاف عمليات الترويج'">
        <label>footer</label>
        <input type="text"  *ngIf="template.language== 'en'" value="Not interested? Tap Stop promotions"   [disabled]="button.text === 'Stop promotions'"  >
        <input type="text"  *ngIf="template.language== 'ar'" value="ألست مهتمًا؟ اضغط على إيقاف عمليات الترويج"   [disabled]="button.text === 'Stop promotions'"  >
      </div>

      <button type="button" class="remove-btn" (click)="removeButton(i)">
        <i class="fas fa-times"></i> 
      </button>
       </div>

       <div class="marketing-opt-out padding-left" *ngIf="button.type === 'QUICK_REPLY' && button.text === 'Stop promotions'">
        <div class="checkbox-label-wrapper">
          <input type="checkbox" [(ngModel)]="isOptOutResponsibilityAcknowledged" (change)="isOptOutResponsibilityAcknowledgedChange()">
          <label>I understand that it's the responsibility to stop sending marketing messages to customers who opt out.</label>
        </div>
        <p class="error-message" *ngIf="!isOptOutResponsibilityAcknowledged">This box must be checked to add this button.</p>
      </div>
    </div>
    </div>
  </div>
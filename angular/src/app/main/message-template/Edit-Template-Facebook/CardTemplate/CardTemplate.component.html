<div class="template-container">
  <h3>WhatsApp Carousel Template</h3>
  <div class="form-group1">
    <div class="carousel-container">
      <div *ngFor="let card of carouselCards; let i = index ; trackBy: trackByCard"class="carousel-card">
        <div class="card-header">
          <h2 >Card {{i + 1}}</h2>
          <button class="remove-btn" (click)="removeCard(i)" *ngIf="carouselCards.length > 1">
            <i class="fas fa-times"></i> Remove Card
          </button>
        </div>
        <!-- <div>
              <button (click)="senddata()">
                clicckk
              </button>
              <button (click)="aaa()">
                test
              </button>
        </div> -->
        <div class="card-content">
          <div class="header-section">
        <div class="card-content" >
          <div class="header-section">
            
            <div class="categories">    
              <h4>Header Card Type :</h4>
              <button 
                class="category-button" 
                [ngClass]="{ active: card.components[0].format === 'IMAGE' }" 
                (click)="onHeaderChange('IMAGE', i)">
                <i class="fas fa-file-image"></i>Image
              </button>
            
              <button 
                class="category-button" 
                [ngClass]="{ active: card.components[0].format === 'VIDEO' }" 
                (click)="onHeaderChange('VIDEO', i)">
                <i class="fas fa-file-video"></i> Video
              </button>
            </div>
          <div *ngIf="card.components[0].format == 'IMAGE'" class="header-option">
            <div class="header-content">
              <h3>Samples for Header Content</h3>
              <p id="imageDescription">To help us review your content, provide examples of the variables or media in the header. Do not include any customer information.</p>
              <label for="headerImage">Image</label>
              <input
              hidden
              class="upload-button hidden-file-input"
              [id]="'headerImage' + i"
              type="file"
              accept="image/*"
              (change)="handleFileInput($event,i)"
              aria-describedby="imageDescription"
            />

            <label [for]="'headerImage' + i" class="custom-upload-button">
              <i class="fas fa-file-image"></i> Choose JPG or PNG File
            </label>
            
            <div *ngIf="card.components[0].example.header_handle[0]!=''"  style="display: inline; padding-left: 20px;">
                <button  class="remove-btn" (click)="clearUploadedFile(i)"><i class="fas fa-times"></i></button>
              </div>
              
              <div style="margin-top: 15px;">
                <p *ngIf="card.components[0].example.header_handle[0]==''" class="instructions error-message">Add sample media</p>
              </div>
            </div>
          </div>
          
          <div *ngIf="card.components[0].format == 'VIDEO'" class="header-option">
            <div class="header-content">
              <h3>Samples for Header Content</h3>
              <p id="videoDescription">To help us review your content, provide examples of the variables or media in the header. Do not include any customer information.</p>
              <label for="headerVideo">Video</label>
                  <input
                  hidden
                  class="upload-button"
                  [id]="'headerVideo' + i"
                  type="file"
                  accept="video/*"
                  (change)="handleFileInput($event,i)"
                  aria-describedby="videoDescription"
                />
              <label [for]="'headerVideo' + i" class="custom-upload-button">
                <i class="fas fa-file-video"></i> Choose MP4 File
              </label>
              <div *ngIf="card.components[0].example.header_handle[0]!=''"   style="display: inline;padding-left: 20px;" class="file-preview">
                <button class="remove-btn" (click)="clearUploadedFile(i)"><i class="fas fa-times"></i></button>
              </div>
              <div style="margin-top: 15px;">
                <p *ngIf="card.components[0].example.header_handle[0]==''"  class="instructions error-message">Add sample media</p>
              </div>
            </div>
          </div>
        </div>
      </div>
        
        <div class="Content-Parts" >
          <h3 for="Body">Card Body </h3>
            <div class="textarea-container" style="position: relative;">
              <textarea
                class="form-control body-text mt-1"
                [(ngModel)]="card.components[1].text"
                  [dir]="getTextDirection(card.components[1].text)"
                (ngModelChange)="onBodyTextChange(card.components[1].text, i)"
                (input)="checkValidationCard()"
                [id]="'bodyText-' + i"
                maxLength="1024"
                rows="6"
                required
                [ngClass]="{'error-body-message': !isTextValid}"
              ></textarea>
              <!-- Character counter -->
              <div class="body-character-counter"
                   [ngClass]="{
                     'text-danger': (card.components[1].text?.length || 0) >= 1000,
                     'text-warning': (card.components[1].text?.length || 0) >= 900 && (card.components[1].text?.length || 0) < 1000
                   }">
                {{card.components[1].text?.length || 0}}/1024
              </div>
            </div>          
            <div *ngIf="card.components[1].text==''">
              <p class="instructions error-message">The Card Body is required</p>
            </div>

            <div *ngIf="showWarningMessage" class="warning-box">
              <ul>
                <li>This template contains too many variable parameters. Decrease them or increase the message length. Example: Hello {{1}} from InfoSeed World</li>
              </ul>
            </div>
         <div *ngIf="!isTextValid"  style="background-color: #fff6dc; padding: 15px;">
            <div class="d-flex">
                <i class="bi bi-exclamation-triangle-fill" style="color: #d27805;"></i>
                <div>
                    This template contains too many variable parameters relative to the message length. You need to decrease the number of variable parameters or increase the message lengthe
                    <div class="innerHint">
                        <span>example :Hello {{ '{{' + 1 + '}}' }} from InfoSeed World</span>
                    </div>
                </div>
            </div>
         </div>
          <div   *ngIf="showWarningMessage" style="background-color: #fff6dc; padding: 15px;">
            <ul>
              <li> This template contains too many variable parameters relative to the message length. You need to decrease the number of variable parameters or increase the message lengthexample :Hello {{1}} from InfoSeed World
              </li>
            </ul>
          </div>
          <div *ngIf="validationMessage" class="validation-message">
          </div>
          <div class="toolbar">
            <button type="button" (click)="toggleEmojiPicker()"> <i class="far fa-grin"></i></button>
            <button type="button" (click)="applyFormat(i,'*', '*')"><i class="fas fa-bold"></i></button>
            <button type="button" (click)="applyFormat(i,'_', '_')"><i class="fas fa-italic"></i> </button>
            <button type="button" (click)="applyFormat(i,'~', '~')"><i class="fas fa-strikethrough"></i> </button>
            <button type="button" (click)="applyFormat(i,'``', '``')"><i class="fas fa-code"></i> </button>
            <button type="button" (click)="insertVariable(i)">
              <i class="bi bi-plus"></i> Add Variable </button>
            <button type="button" (click)="deleteLastVariable(i)">
              <i class="bi bi-dash"></i> Delete Variable</button>
          </div>

          <div class="emoji-container" *ngIf="showEmojiPicker">
            <emoji-mart 
              (emojiClick)="addEmoji(i,$event)">
            </emoji-mart>
           </div>
          </div>
          <div class="group-variable" *ngIf="card.components[1].example.body_text[0]">
            <h3>Samples for body Card</h3>
            <p>To help us review your message template, please add an example for each variable in your body text. Do not use real customer information. Cloud API hosted by Meta reviews templates and variable parameters to protect the security and integrity of our services.</p>
            <div class="sample-variable" *ngFor="let value of card.components[1].example.body_text[0]; let j = index; trackBy: trackByIndex2">
              <label>{{ '{{' + (j + 1) + '}}' }}</label>
              <input type="text"
                    [(ngModel)]="card.components[1].example.body_text[0][j]"
                    placeholder="Example value for {{ j + 1 }}"
                    class="form-control mb-2"
                    (input)="checkValidationSampilBody()"
                    >
            </div>
          </div>
            <div *ngIf="errorUnEqualVaribleBody">
              <p class="instructions error-message">is must be number of varibles it same in each cards</p>
            </div>
            <div *ngIf="!sampilBodyValid">
              <p class="instructions error-message">Add sample text</p>
            </div>
          </div>
<div class="form-groupkk ">
  <h3>Buttons</h3>
  <div class="container-addButton ">
    <div class="dropdown">
      <button class=" dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
        + Add Button
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <!-- <h3>Quick reply buttons</h3> -->
        <button  class="dropdown-item" (click)="onButtonTypeChange('QUICK_REPLY', i)"  [disabled]="buttonLimits[i]" >
          Quick reply </button>
        <div class="dropdown-divider"></div>
        <!-- <h3>Call to action buttons</h3> -->
        <button class="dropdown-item" (click)="onButtonTypeChange('visit-website', i )" [disabled]="buttonLimits[i]">
          Visit website 
          <!-- <span class="button-limit">2 buttons maximum</span> -->
        </button>
        <button class="dropdown-item" (click)="onButtonTypeChange('call-phone-number', i)" [disabled]="buttonLimits[i]">
          Call phone number 
          {{buttonLimits[i]}}
          <!-- <span class="button-limit">1 button maximum</span> -->
        </button>
        </ul>
    </div>
  </div>
  <!-- <div  class="CompleteFlowNote box-shadow" *ngIf="expression">
    <span  class="icon-lamp">💡</span>
    <span class="note-text">
      <h3>We recommend adding the marketing opt-out button</h3>
      <p>Allow customers to request to opt out of all marketing messages. This can help reduce blocks from customers and increase your quality rating. Learn more.</p>
    </span>
  </div> -->

  <div class="buttons-section" >
    <div *ngIf="CallToAction">
      <p>Call to Action <span class="Optional">• Optional</span></p>
    </div>
    <div>
    <div *ngFor="let button of card.components[2].buttons; let j = index" >
      <div class="button-row" *ngIf="button.type === 'URL' || button.type === 'PHONE_NUMBER' || button.type === 'QUICK_REPLY' || button.type === 2">       
       <div class="field padding-left" >
         <label>Type of Button</label>
         <select [(ngModel)]="button.type" (change)="onActionChange(button,i)">
          <option value="URL">Visit website</option>
          <option value="PHONE_NUMBER">Call phone number</option>
          <option value="QUICK_REPLY" >Quick Reply</option>
          <!-- <option value="QUICK_REPLY" [disabled]="buttonLimits[i]">Quick Reply</option> -->
        </select>
       </div>
 
       <div class="field">
          <label>Button Text</label>
          <div class="button-input-container" style="position: relative;">
            <input 
              type="text"
              (input)="validateButtons2(i)"
              placeholder="Button Text" 
              [(ngModel)]="button.text"
              required
              maxlength="25"
              class="button-text-input"
            >
            <span class="button-text-counter"
                  [ngClass]="{
                    'text-danger': (button.text?.length || 0) >= 25,
                    'text-warning': (button.text?.length || 0) >= 20 && (button.text?.length || 0) < 25
                  }">
              {{button.text?.length || 0}}/25
            </span>
          </div>
          <span *ngIf="!button.text" class="error-message">
            You can't leave the text empty
          </span>
          <span *ngIf="buttonTextErorr[i]" class="error-message">
            You can't enter the same text for multiple buttons
          </span>
        </div>



       <div class="field" *ngIf="button.type === 'URL'">
        <label>URL Type</label>
        <select  (change)="OnURLTypeChange(button,i,j)">
          <option value="Static" [selected]="!button.example">Static</option>
          <option value="Dynamic" [selected]="button.example">Dynamic</option>
        </select>
      </div>
       <div class="field" *ngIf="button.type == 'URL'">
         <label>Website URL</label>
         <div class="url-container">
           <input style="width: 50%;"  class="error-border" type="url"
                  placeholder="https://www.example.com"
                  [(ngModel)]="button.url"
                  [ngModelOptions]="{standalone: true}" 
                  [pattern]="urlPattern"
                  (input)="onURLChange($event, i, j)"
                  required
                  maxlength="2000"
                  />
           <span *ngIf="button.example && button.type == 'URL'">{{'/{{1}}'}}</span>
         </div>  
         <label *ngIf="buttonErrors[i][j]"  class="error-message">Please enter a valid URL</label> 
       </div>

       <div class="field" *ngIf="button.type == 'PHONE_NUMBER'">
        <label>Country</label>
        <ngx-intl-tel-input
        #telInput
        style="width: 150%;"
        class="d-contents"
        [cssClass]="'phone-input-' + i + '-' + j"
        [enablePlaceholder]="true"
        [searchCountryFlag]="true"
        [maxLength]="13"
        [selectFirstCountry]="false"
        [enableAutoCountrySelect]="true"
        [phoneValidation]="true"
        [separateDialCode]="false"
        [numberFormat]="'International'"
        [preferredCountries]="preferredCountries"
        [(ngModel)]="tempPhoneNumbers[i][j]"
        required
        (input)="onPhoneNumberChange(i, j, $event)"
        (countryChange)="onPhoneNumberChange(i, j, $event)"
      ></ngx-intl-tel-input>
      
      <div *ngIf="phoneErrors[i][j]" class="error-message">
        Please enter a valid phone number. 
        <span *ngIf="button.phone_number?.startsWith('+962')">Jordan numbers: 7XXXXXXXX (9 digits)</span>
        <span *ngIf="button.phone_number?.startsWith('+966')">Saudi numbers: 5XXXXXXXX (9 digits)</span>
      </div>
      </div>
       <button type="button" *ngIf="card.components[2].buttons.length > 1" class="remove-btn" (click)="removeButton(i,j)">
         <i class="fas fa-times"></i>
       </button>
     </div>
    
     <div *ngIf="button.example && button.type == 'URL'" class="sample-inputs Content-Parts padding-left" style="padding-left: 20px;" >
       <h3>Add sample URL</h3>
       <p>To help us review your message template, please add an example of the website URL Do not use real customer information.</p>
       <div  class="sample-URL">
         <label  style="display: inline;">{{'{{1}}'}}</label>
         <input 
           type="text" 
           [ngModelOptions]="{standalone: true}" 
           [pattern]="urlPattern"
           [(ngModel)]="button.example[0]"
           (input)="onURLExampleChange($event,i)"
           placeholder="Enter full URL  {{'{{1}}'}}"
           required
         />
       </div>
       <div  *ngIf="button.example[0].length===0">
         <p class="instructions error-message">Please enter a valid website URL</p>
       </div>
       
     </div>

   </div>

     <div  *ngIf="!ButtonCountEqual"  class="sample-inputs Content-Parts padding-left">
         <span class="error-message">
          Make both cards have the same number of buttons and in the same order and types.
        </span>
     </div>
    <div *ngIf="hasQuickReply">
      <p>Quick Reply<span class="Optional">• Optional</span></p>
    </div>
    <div>
    </div>
    </div>
  </div>

        </div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button type="button" class="btn btn-primary add-card-btn" (click)="addNewCard()" 
            [disabled]="carouselCards.length >= maxCards">
      <i class="fas fa-plus"></i> Add Another Card ({{carouselCards.length}}/{{maxCards}})
    </button>
    <!-- <button (click)="checkValidationCard()">valid card check</button> -->
  </div>
</div>
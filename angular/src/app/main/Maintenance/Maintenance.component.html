
<div [@routerTransition]>
  
    <div class=" d-flex flex-column flex-column-fluid">
     <sub-header [title]="'Maintenances' | localize" [description]="'MaintenancesHeaderInfo' | localize">
               <div role="actions">
                   <!-- <button (click)="exportToExcel()" class="btn btn-outline-success"><i class="fa fa-file-excel"></i> {{l("ExportToExcel")}}</button> -->
                  
                   <!-- <button  (click)="deleteAllForEver()"  *ngIf="isAdmin"
                                          class="btn btn-primary blue"><i class="fa fa-trash p-0 font-12"></i> {{l("Delete All Orders")}}</button> -->
               </div>
              </sub-header>
      
      <div [class]="containerClass">
          <div class="card card-custom gutter-b">
              <div class="card-body">
                <form class="form" autocomplete="off">
                    <div>
                        <div class="row align-items-center">
                            <div class="col-xl-12">
                                <div class="form-group m-form__group align-items-center">
                                    <div class="input-group">
       
                                      
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </form>
  
                  <div class="row align-items-center">
                      <!--<Primeng-Datatable-Start>-->
                      <div class="primeng-datatable-container col-12"
                           [busyIf]="primengTableHelper.isLoading">
                          <p-table #dataTable
                                       (onLazyLoad)="getMaintenance($event)"
                                       [value]="primengTableHelper.records"
                                       rows="{{primengTableHelper.defaultRecordsCountPerPage}}"
                                       [paginator]="false"
                                       [lazy]="true"
                                       [scrollable]="true"
                                       ScrollWidth="100%"
                                       [responsive]="primengTableHelper.isResponsive"
                                       [resizableColumns]="primengTableHelper.resizableColumns">

                                       
                              <ng-template pTemplate="header">
                                  <tr>
                                      <th  >{{l('Actions')}}</th>

                                      <th   pSortableColumn="AgentId" >
                                        {{l('Agent')}}
                                        <!-- <p-sortIcon field="order.AgentId"></p-sortIcon> -->
                                       </th>
   


                                      <th  pSortableColumn="contactId" >
                                        {{l('Customer')}}
                                        <!-- <p-sortIcon field="order.contactId"></p-sortIcon> -->
                                    </th>
                                    <th  pSortableColumn="contactId" >
                                        {{l('Phone Number')}}
                                        <!-- <p-sortIcon field="order.contactId"></p-sortIcon> -->
                                    </th>

                                      <th  pSortableColumn="creationTime">
                                          {{l('Date')}}
                                          <!-- <p-sortIcon field="order.creatTime"></p-sortIcon> -->
                                      </th>

                                      <th  pSortableColumn="creationTime" >
                                        {{l('Time')}}
                                        <!-- <p-sortIcon field="order.creationTime"></p-sortIcon> -->
                                    </th>


                                    
                                    <th  pSortableColumn="orderStatus" >
                                        {{l('Status')}}
                                        <!-- <p-sortIcon field="order.orderStatus"></p-sortIcon> -->
                                    </th>

                                   

                                    <th  pSortableColumn="Total" >
                                        {{l('Total')}}
                                        <!-- <p-sortIcon field="order.total"></p-sortIcon> -->
                                    </th>

  
                                  </tr>
                              </ng-template>                           
                              <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                               

                                  <tr  >
                                    <td  style=" background-color: #ffffff;">
                                       <div class="btn-group dropdown" dropdown container="body" *ngIf="!record.isLockByAgent || record.agentId==appSession.user.id || isAdmin">
                                            <button class="dropdown-toggle btn btn-sm btn-primary" style="cursor: pointer;"   dropdownToggle>
                                                <i class="fa fa-cog"></i><span class="caret"></span> {{l("Actions")}}
                                            </button >
                                                <ul class="dropdown-menu"  *dropdownMenu>

                                                  <li >
                                                      <a href="javascript:;" class="dropdown-item" *ngIf="!record.isLockByAgent"
                                                          (click)="lockOrder(record,record.stringTotal)">{{l('Lock')}}</a>
                                                  </li>
                                                  <li>
                                                    <a href="javascript:;" class="dropdown-item " *ngIf="record.isLockByAgent"
                                                          (click)="UnlockOrderS(record,record.stringTotal)">{{l('UnLock')}}</a>
                                                </li>
                                                  
                                                <li>
                                                    <a href="javascript:;" class="dropdown-item"
                                                        (click)="viewMaintenanceModal.show(record)">{{l('View')}}</a>
                                                </li>

                                                <!-- <li>
                                                    <a href="javascript:;" class="dropdown-item" *ngIf="isAdmin"
                                                        (click)="deleteForEver(record)">{{l('Delete')}}</a>
                                                </li> -->
                                               
                                                <!-- <li>
                                                <a href="javascript:;"  class="dropdown-item"
                                                        (click)="createOrEditOrderModal.show(record.id)">{{l('Edit')}}</a>												
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" href="javascript:;"
                                                        (click)="deleteOrder(record)">{{l('Delete')}}</a>
                                                </li> -->
                                            </ul>
                                        </div>
                                    </td>


                                  <td style=" background-color: #ffffff;font-family: system-ui; cursor: pointer" (click)="viewMaintenanceModal.show(record)">
                                    <span class="p-column-title"> {{l('Agent')}}</span>
                                    {{record.lockByAgentName}}
                                </td>






                                        <td  style=" background-color: #ffffff;font-family: system-ui;cursor: pointer"  (click)="viewMaintenanceModal.show(record)">
                                            <span class="p-column-title"> {{l('Customer')}}</span>
                                            {{record.displayName}}
                                        </td>

                                        <td  style=" background-color: #ffffff;font-family: system-ui;cursor: pointer"  (click)="viewMaintenanceModal.show(record)">
                                            <span class="p-column-title"> {{l('Phone Number')}}</span>
                                            {{record.phoneNumber}}
                                        </td>


                                        <td style=" background-color: #ffffff;font-family: system-ui;cursor: pointer" (click)="viewMaintenanceModal.show(record)">
                                          <span class="p-column-title"> {{l('Date')}}</span>
                                          {{record.creationDateString}}
                                      </td>
                                      
                                      

                                    <td style="background-color: #ffffff; font-family: system-ui;cursor: pointer"  (click)="viewMaintenanceModal.show(record)">
                                      <span class="p-column-title"> {{l('Time')}}</span>
                                      {{record.creationTimeString}}
                                  </td>



                                      <td  style="background-color: #ffffff; font-family: system-ui;cursor: pointer"  (click)="viewMaintenanceModal.show(record)">
                                        <span class="p-column-title"> {{l('Status')}}</span>

                                        <button *ngIf="record.orderStatusName=='Done'" class="btn btn-success" style="pointer-events: none;font-size: medium; color: #ffffff; background-color: #00ba36; border-color: #1BC5BD;width: 100px;">Done</button>
                                        <button *ngIf="record.orderStatusName=='Deleted'" class="btn btn-secondary" style="pointer-events: none;font-size: medium;width: 100px; ">Deleted</button>
                                        <button *ngIf="record.orderStatusName=='Pending'" class="btn btn-danger" style="pointer-events: none;font-size: medium;width: 100px; ">Pending</button>
                                        <button *ngIf="record.orderStatusName=='Canceled'" class="btn btn-warning" style="pointer-events: none;font-size: medium; width: 100px;">Canceled</button>
                                        <button *ngIf="record.orderStatusName=='Pre_Order'" class="btn btn-primary" style="pointer-events: none;font-size: medium; color: #ffffff; background-color: #007bff; border-color: #007bff; width: 100px;">Pre_Order</button>
                                    </td>

                                
                                      
                                      <td style=" background-color: #ffffff;font-family: system-ui;cursor: pointer"  (click)="viewMaintenanceModal.show(record)">
                                          <span class="p-column-title"> {{l('Total')}}</span>
                                          {{record.stringTotal}} 
                                      </td>


                                </tr>


                                 
                              </ng-template>
                          </p-table>
                          <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                              {{l('NoData')}}
                          </div>
                          <div class="primeng-paging-container">
                              <p-paginator [rows]="primengTableHelper.defaultRecordsCountPerPage"
                                           #paginator
                                           (onPageChange)="getMaintenance($event)"
                                           [totalRecords]="primengTableHelper.totalRecordsCount"
                                           [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">
                              </p-paginator>
                              <span class="total-records-count">
                                  {{l('TotalRecordsCount', primengTableHelper.totalRecordsCount)}}
                              </span>
                          </div>
                      </div>
                      <!--<Primeng-Datatable-End>-->
                  </div>
              </div>
          </div>
      </div>
      <!-- <createOrEditOrderModal #createOrEditOrderModal (modalSave)="getMaintenance()"></createOrEditOrderModal>     -->
      <viewMaintenanceModal #viewMaintenanceModal></viewMaintenanceModal>
      
    </div>
  </div>
  
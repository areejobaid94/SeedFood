<div class="card-custom gutter-b card">
    <div class="card-body">
        <p-dialog
            *ngIf="groupAddResult"
            header="Header"
            [closeOnEscape]="false"
            [closable]="false"
            [resizable]="false"
            [modal]="true"
            [maximizable]="true"
            appendTo="body"
            [(visible)]="visible"
            [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
            [style]="{ width: '75vw' }"
            [contentStyle]="{ height: '450px' }"
        >
            <ng-template pTemplate="header">
                <div class="inline-flex align-items-center justify-content-center gap-2">
                    <span class="font-bold white-space-nowrap"> {{ l("information") }}</span>
                </div>
            </ng-template>
            <ng-container *ngIf="groupAddResult.state === 2 && groupAddResult.failedCount > 0">
                <p *ngIf="groupAddResult.successCount > 0">
                    <span style="color: green">{{ groupAddResult?.successCount }}</span> {{ l("ContactsSuccessfullyAddedToGroup") }}
                </p>

                <p-table
                    responsiveLayout="stack"
                    [breakpoint]="'960px'"
                    [value]="groupAddResult.failedAdd"
                    [scrollable]="true"
                    scrollHeight="flex"
                    [tableStyle]="{ 'min-width': '20rem' }"
                >
                    <ng-template pTemplate="caption">
                        <ng-container *ngIf="groupAddResult">
                            {{ l("numberOfInvalidNumber") }} <span [ngStyle]="{ color: 1 ? 'red' : 'green' }">{{ groupAddResult.failedCount }}</span>
                        </ng-container>
                    </ng-template>

                    <ng-template pTemplate="header">
                        <tr>
                            <th>{{ l("ContactName") }}</th>
                            <th>{{ l("PhoneNumber") }}</th>
                            <th>{{ l("createGroupFromExcelReason") }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-contact>
                        <tr>
                            <td>{{ contact.displayName }}</td>
                            <td>{{ contact.phoneNumber }}</td>
                            <td *ngIf="contact.failedId === 1">{{ l("errorWhileAdding") }}</td>
                            <td *ngIf="contact.failedId === 2">{{ l("numberAlreadyExistsInGroup") }}</td>
                            <td *ngIf="contact.failedId === 3">{{ l("phoneNumberValidationFailed") }}</td>
                            <td *ngIf="contact.failedId === 4">{{ l("thisNumberInGroup") }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </ng-container>

            <ng-template pTemplate="footer">
                <p-button icon="pi pi-check" (click)="visible = false" label="Ok" pAutoFocus [autofocus]="true"></p-button>
            </ng-template>
        </p-dialog>

        <div class="row justify-content-between">
            <div class="divider divider-default">
                <div class="divider-text">{{ l("extractMemberFromInternal") }}</div>
            </div>
            <div class="row p-0 p-xl-1 m-0">
                <div class="row">
                    <div class="col mb-1">
                        <div class="form-group">
                            <label for="countryGroupCode" placement="top" triggers="mouseenter:mouseleave" class="mr-4">{{ l("countryCode") }}</label>

                            <ngx-intl-tel-input
                                [ngClass]="isArabic ? 'rtl' : ''"
                                class="d-contents"
                                id="countryGroupCode"
                                [preferredCountries]="preferredCountries"
                                [enablePlaceholder]="false"
                                [enableAutoCountrySelect]="false"
                                [searchCountryFlag]="false"
                                [maxLength]="0"
                                [selectFirstCountry]="true"
                                [phoneValidation]="true"
                                [separateDialCode]="separateDialCode"
                                [numberFormat]="PhoneNumberFormat.National"
                                [(ngModel)]="countryObj"
                                (countryChange)="getCountryCode($event)"
                                required
                            >
                            </ngx-intl-tel-input>
                        </div>
                    </div>
                    <div class="col mb-1">
                        <div class="form-group">
                            <label class="mr-4" for="Phone">{{ l("customer") }}</label>

                            <input id="Phone" name="Phone" type="text" class="form-control" [(ngModel)]="contact.contactName" />
                        </div>
                    </div>
                    <div class="w-100"></div>
                    <div class="col mb-1">
                        <div class="form-group">
                            <label for="range-input" class="mr-4" placement="top" triggers="mouseenter:mouseleave">
                                {{ l("joiningDate") }}
                            </label>
                            <span class="font-size-h6 mr-4">
                                <i (click)="initializeDateRange()" class="fas fa-undo"></i>
                            </span>
                            <input
                                type="text"
                                class="form-control"
                                id="range-input"
                                [(ngModel)]="dateRange"
                                placement="bottom left"
                                [bsConfig]="dateRangePickerOptions"
                                bsDaterangepicker
                            />
                        </div>
                    </div>
                    <div class="col mb-1">
                        <div class="form-group">
                            <label for="behaviorGroup" class="mr-4" placement="top" triggers="mouseenter:mouseleave">{{ l("customerBehavior") }} </label>
                            <!-- <p-multiSelect [options]="dropdownList" [(ngModel)]="selectedItems" optionLabel="name"></p-multiSelect> -->

                            <ng-multiselect-dropdown
                                class="dropdownbehaviour"
                                [ngClass]="darkModeService.currentSkin === 'dark' ? 'dark ' : ''"
                                id="behaviorGroup"
                                [settings]="dropdownSettings"
                                [data]="dropdownList"
                                [(ngModel)]="selectedItems"
                                required
                                [class.error]="filtered && behavior.invalid"
                                #behavior="ngModel"
                            >
                            </ng-multiselect-dropdown>
                            <p class="text-danger" *ngIf="filtered && behavior.invalid">{{ l("ThisFieldIsRequired") }}</p>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end flex-wrap gap-2">
                    <button class="btn btn-primary-info d-flex align-items-center" (click)="filterContacts($event)">
                        {{ l("Filter Out") }}
                        <i class="fas fa-search ms-2"></i>
                    </button>
                
                    <button class="btn btn-primary-info d-flex align-items-center" [buttonBusy]="submitted"
                        [disabled]="selectedContact.length === 0" (click)="handleSubmit($event)">
                        {{ l("Save") }}
                        <i class="fa fa-save ms-2"></i>
                    </button>
                </div>

            </div>
        </div>

        <div class="row">
            <div class="primeng-datatable-container p-0" [busyIf]="primengTableHelper.isLoading">
                <p-table
                    #dataTable
                    [(selection)]="selectedContact"
                    [value]="primengTableHelper.records"
                    responsiveLayout="stack"
                    [selectionPageOnly]="true"
                    rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                    [lazy]="true"
                    dataKey="phoneNumber"
                    [resizableColumns]="primengTableHelper.resizableColumns"
                >
                    <ng-template pTemplate="caption">
                        <ng-container *ngIf="selectedContact?.length > 0">
                            {{ l("numberOfSelectedMembers") }} <span style="color: green">{{ selectedContact?.length }}</span>
                        </ng-container>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 4rem" [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''">
                                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                            </th>
                            <th [ngClass]="darkModeService.currentSkin === 'dark' ? 'dark-table' : ''" pSortableColumn="contactName">
                                <span class="p-column-title">{{ l("customer") }}</span>
                            </th>
                            <th [ngClass]="darkModeService.currentSkin === 'dark' ? 'dark-table' : ''" pSortableColumn="phoneNumber">
                                {{ l("PhoneNumber") }}
                            </th>
                            <th class="behaviour-column" [ngClass]="darkModeService.currentSkin === 'dark' ? 'dark-table' : ''" pSortableColumn="customerOPT">
                                {{ l("Behaviour") }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                        <tr [style.color]="record.customerOPT == 1 ? 'red' : ''">
                            <td [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''">
                                <p-tableCheckbox [value]="record"></p-tableCheckbox>
                                <span class="p-column-title"> {{ l("Select") }}</span>
                            </td>
                            <td [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''">
                                <span class="p-column-title"> {{ l("ContactName") }}</span>
                                {{ record.displayName }}
                            </td>

                            <td [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''">
                                <span class="p-column-title"> {{ l("PhoneNumber") }}</span>
                                {{ record.phoneNumber }}
                            </td>
                            <td [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''" class="neutral customer-behaviour"
                                *ngIf="record.customeropt === 0">
                                <span class="p-column-title"> {{ l("customerBehavior") }}</span>
                                {{ l("netural") }}
                            </td>
                            <td [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''" class="optOut customer-behaviour"
                                *ngIf="record.customeropt === 1">
                                <span class="p-column-title"> {{ l("customerBehavior") }}</span>
                                {{ l("optOut") }}
                            </td>
                            <td [ngClass]="darkModeService.currentSkin === 'dark' ? 'table-dark' : ''" class="optIn customer-behaviour"
                                *ngIf="record.customeropt === 2">
                                <span class="p-column-title"> {{ l("customerBehavior") }}</span>
                                {{ l("optIn") }}
                            </td>
                            </tr>
                            </ng-template>
                </p-table>
                <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                    {{ l("NoData") }}
                </div>
                <div class="primeng-paging-container">
                    <p-paginator
                        [ngClass]="darkModeService.currentSkin === 'dark' ? 'dark' : ''"
                        [rows]="primengTableHelper.defaultRecordsCountPerPage"
                        #paginator
                        (onPageChange)="PaginatorContacts($event)"
                        [rows]="20"
                        [totalRecords]="primengTableHelper.totalRecordsCount"
                        [rowsPerPageOptions]="[10, 500, 1000]"
                    >
                    </p-paginator>
                    <span class="total-records-count">
                        {{ l("TotalRecordsCount", primengTableHelper.totalRecordsCount) }}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

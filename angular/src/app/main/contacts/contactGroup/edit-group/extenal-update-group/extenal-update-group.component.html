<div class="card-custom gutter-b card">
    <div class="card-body">
        <p-dialog
            *ngIf="groupAddResult"
            header="Header"
            [closeOnEscape]="false"
            [closable]="false"
            [resizable]="false"
            [modal]="true"
            [maximizable]="true"
            appendTo="body"
            [(visible)]="visible"
            [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
            [style]="{ width: '75vw' }"
            [contentStyle]="{ height: '450px' }"
        >
            <ng-template pTemplate="header">
                <div class="inline-flex align-items-center justify-content-center gap-2">
                    <span class="font-bold white-space-nowrap"> {{ l("information") }}</span>
                </div>
            </ng-template>

            <ng-container *ngIf="groupAddResult.state === 2 && groupAddResult.failedCount > 0">
                <p *ngIf="groupAddResult.successCount > 0">
                    <span style="color: green">{{ groupAddResult.successCount }}</span> Contact Successfully Added To Group
                </p>
                <p-table
                    responsiveLayout="stack"
                    [breakpoint]="'960px'"
                    [value]="groupAddResult.failedAdd"
                    [scrollable]="true"
                    scrollHeight="flex"
                    [tableStyle]="{ 'min-width': '20rem' }"
                >
                    <ng-template pTemplate="caption">
                        <ng-container *ngIf="groupAddResult">
                            {{ l("numberOfInvalidNumber") }} <span [ngStyle]="{ color: 1 ? 'red' : 'green' }">{{ groupAddResult.failedCount }}</span>
                        </ng-container>
                    </ng-template>

                    <ng-template pTemplate="header">
                        <tr>
                            <th>{{ l("ContactName") }}</th>
                            <th>{{ l("PhoneNumber") }}</th>
                            <th>{{ l("createGroupFromExcelReason") }}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-contact>
                        <tr>
                            <td>{{ contact.displayName }}</td>
                            <td>{{ contact.phoneNumber }}</td>
                            <td *ngIf="contact.failedId === 1">{{ l("errorWhileAdding") }}</td>
                            <td *ngIf="contact.failedId === 2">{{ l("numberAlreadyExistsInGroup") }}</td>
                            <td *ngIf="contact.failedId === 3">{{ l("phoneNumberValidationFailed") }}</td>
                            <td *ngIf="contact.failedId === 4">{{ l("thisNumberInGroup") }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </ng-container>

            <ng-template pTemplate="footer">
                <p-button icon="pi pi-check" (click)="visible = false" label="Ok" pAutoFocus [autofocus]="true"></p-button>
            </ng-template>
        </p-dialog>

        <div class="row justify-content-between">
            <div class="divider divider-default">
                <div class="divider-text">{{ l("extractMemberFromExcel") }}</div>
            </div>
            <div class="row p-0 p-xl-1 m-0">
                <div class="row">
                    <div class="col mb-1">
                        <div class="form-group">
                            <div class="container-upload-file" appDnd (fileDropped)="onFileDropped($event)" appUpload>
                                <input type="file" #fileDropRef id="fileDropRef" accept=".xlsx, .xls" (change)="fileBrowseHandler($event.target.files)" />
                                <img src="../../../../../assets/images/ic-upload-file.svg" alt="" />
                                <h3>{{ l("draganddrop") }}</h3>
                                <h3>{{ l("browsForFileOR") }}</h3>
                                <label for="fileDropRef">{{ l("browsForFile") }}</label>
                                <div class="files-list">
                                    <div class="single-file" *ngIf="file">
                                        <img src="../../../../../assets/images/ic-file.svg" width="45px" alt="file" />
                                        <div class="info-file-upload">
                                            <h4 class="name">
                                                {{ file.name }}
                                            </h4>
                                            <p class="size">
                                                {{ formatBytes(file.size, 0.0) }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ngb-alert [dismissible]="false" *ngIf="contactLength > 0" style="display: flex; background: none !important; justify-content: center">
                            <div class="alert-body alert-primary">
                                <span [data-feather]="'info'" [class]="'mr-50 align-middle mx-1'"></span>
                                <span>
                                    <strong> You have {{ totalSucceeded }} of Valid Numbers</strong>
                                </span>
                            </div>
                            <div class="alert-body alert-warning" style="margin-left: 10px">
                                <span [data-feather]="'info'" [class]="'mr-50 align-middle mx-1'"></span>
                                <span>
                                    <strong> You have {{ totalFailed }} of Failed Numbers</strong>
                                </span>
                                <a *ngIf="totalFailed > 0" (click)="exportToExcel()" style="margin-left: 5px; color: firebrick">download invalid numbers</a>
                            </div>
                        </ngb-alert>

                    </div>
                    <div class="w-100"></div>
                </div>

                <div class="row mt-1 p-xl-0 p-1">
                    <div class="col-12">
                        <div class="d-flex justify-content-end flex-wrap gap-2">
                            <!-- Download Sample Button -->
                            <a class="btn btn-primary-info d-flex align-items-center"
                                href="https://infoseedmediastorageprod.blob.core.windows.net/4408da24-aad7-4802-a1f1-46f5ad9e2074/GroupSampleF.xlsx"
                                download="proposed_file_name">
                                {{ l("downloadSample") }}
                                <i class="fa fa-download ms-2"></i>
                            </a>
                
                            <!-- Save Button -->
                            <button class="btn btn-primary-info d-flex align-items-center" [buttonBusy]="submitted"
                                [disabled]="totalSucceeded <= 0" (click)="handleGroup()">
                                {{ l("Save") }}
                                <i class="fa fa-save ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
